 - name: Create a full clone of template 9999
   community.general.proxmox_kvm:
      node: "artoria"
      api_user: "root@pam"
      api_password: "{{ password }}"
      api_host: "artoria"
      clone: template
      vmid: 9999
      newid: "{{ vmid }}"
      name: "{{ hostname }}"
      storage: "local-zfs"
      format: "raw"

 - name: modify vm to specified specs 
   community.general.proxmox_kvm:
      node: "artoria"
      api_user: "root@pam"
      api_password: "{{ password }}"
      api_host: "artoria"
      vmid: "{{ vmid }}"
      cores: "{{ cpu }}"
      memory: "{{ mem }}"
      ipconfig: 
        ipconfig0: "ip={{ ipadr }}/24,gw={{ gateway  }}"
      update: true 

 - name: set vlan tag
   shell: sudo qm set {{ vmid }} -net0 virtio,bridge=vmbr0,tag={{ vlanTag }}

 - name: resize the disk
   shell: sudo qm resize {{ vmid }} scsi0 +{{ disksize }}G

 - name: start the vm
   community.general.proxmox_kvm:
     node: "artoria"
     api_user: "root@pam"
     api_password: "{{ password }}"
     api_host: "artoria"
     vmid: "{{ vmid }}"
     state: started
